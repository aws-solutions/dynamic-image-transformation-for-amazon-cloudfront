pipeline {
    agent {
        node {
            label 'master'
        }
    }
    stages {
        stage('Prepare') { 
            steps {
                node('master'){
                    cleanWs()
                    sh 'pwd'
                    sh 'ls'
                    sh 'mkdir image'
                    sh 'cd image'
                    sh '''
                    git clone https://github.com/PatientPopInc/serverless-image-handler.git  && echo pwd
                    '''
                    sh 'sleep 10s'

                }

            }
        }
        stage('Build') { 
            steps {
                node('master'){
                    sh '''
                    cd serverless-image-handler/deployment
                    git checkout MAIN-142-Image-Resizing-Build
                    sudo ./build-s3-dist.sh patientpop
                    aws s3 cp --recursive dist/ s3://irshadsource/latest
                    '''
                    cleanWs()
                }
            }
        }
        
    }
}